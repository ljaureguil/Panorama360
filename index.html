<!DOCTYPE html>
<html lang="en">

<head>
    <title>CubemapToEquirectangular - Managed</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">
    <style>
        body {
            font-family: Monospace;
            background-color: #f0f0f0;
            color: white;
            margin: 0px;
            overflow: hidden;
        }
        #capture {
            position: absolute;
            left: 20px;
            top: 20px;
            padding: 10px;
            border: 1px solid white;
            z-index: 100;
            cursor: pointer;
            background-color: rgba(0, 0, 0, .4);
        }
    </style>
</head>

<body>
  

    <div id="capture"><span id="capturea">Capture</span>
  <input type=file name=filename id=file>
    <button type=button onclick='test()'>Display</button></br>


    </div> 
   
    <script src="textures.js"></script>
    <script src="js/ImageData-polyfill.js"></script>
    <script src="js/canvas.toBlob-polyfill.js"></script>
    <script src="js/three.min.js"></script> 
  

    <script src="js/OrbitControls.js"></script> 
      <script src="TrackballControls.js"></script>
    <script src="js/CubemapToEquirectangular.js"></script>
  

    <script>
 
    </script>
    
     
    
    



    <script>


        var equi;

        var container, stats;
        var camera, scene, renderer;
        var controls;

        var radius = 100,
            theta = 0;

        window.addEventListener('load', function() {
            init();
            animate();
        });

        var cubeCamera;
        var sphere,pr2;
       
        function init() {

            container = document.createElement('div');
            document.body.appendChild(container);

            camera = new THREE.PerspectiveCamera(70, window.innerWidth / window.innerHeight, 1, 10000);
            camera.position.set(1, 1, 1);

            scene = new THREE.Scene();

            var light = new THREE.DirectionalLight(0xffffff, 1);
            light.position.set(1, 1, 1).normalize();
            scene.add(light);

			alight = new THREE.AmbientLight( 0xaaaaaa );
			scene.add(alight)
            var textureLoader = new THREE.TextureLoader();
             textureLoader.load(w1, function(texture) {

                texture.mapping = THREE.UVMapping;

                matworld1 = new THREE.MeshBasicMaterial({
                    side: THREE.DoubleSide,
                    map: texture,
                    transparent: true,
                    opacity: 1 //.450
                });
                world1 = new THREE.Mesh(new THREE.SphereBufferGeometry(1000, 32, 16), matworld1);
                world1.scale.x = -1;
                scene.add(world1);
            })
            var geometry = new THREE.BoxBufferGeometry( 150,210, 150);
            var pr1,pr2,pr3;
            textureLoader.load(pic1, function(texture) {
           pr1=crOb(texture,geometry)
               pr1.position.x = Math.random() * 1200 - 400;
                pr1.position.y = Math.random() * 1200 - 400;
                pr1.position.z = Math.random() * 1200 - 400;

             scene.add(pr1)

            });

            textureLoader.load(pic4, function(texture) {
           pr1=crOb(texture,geometry)
               pr1.position.x = Math.random() * 1200 - 400;
                pr1.position.y = Math.random() * 1200 - 400;
                pr1.position.z = Math.random() * 1200 - 400;

             scene.add(pr1)

            });
            textureLoader.load(pic2, function(texture) {
           pr2=crOb(texture,geometry)
           pr2.position.x = Math.random() * 800 - 400;
                pr2.position.y = Math.random() * 2000 - 400;
                pr2.position.z = Math.random() * 800 - 400;

             scene.add(pr2)
                
            });  
            textureLoader.load(pic1, function(texture) {
           pr1=crOb(texture,geometry)
               pr1.position.x = Math.random() * 1200 - 400;
                pr1.position.y = Math.random() * 1200 - 400;
                pr1.position.z = Math.random() * 1200 - 400;

             scene.add(pr1)

            });
            textureLoader.load(pic2, function(texture) {
           pr2=crOb(texture,geometry)
           pr2.position.x = Math.random() * 800 - 400;
                pr2.position.y = Math.random() * 800 - 400;
                pr2.position.z = Math.random() * 800 - 400;

             scene.add(pr2)
                
            });  

            textureLoader.load(pic5, function(texture) {
           pr2=crOb(texture,geometry)
           pr2.position.x = Math.random() * 800 - 400;
                pr2.position.y = Math.random() * 800 - 400;
                pr2.position.z = Math.random() * 800 - 400;

             scene.add(pr2)
                
            });  
            textureLoader.load(pic1, function(texture) {
           pr1=crOb(texture,geometry)
               pr1.position.x = Math.random() * 800 - 400;
                pr1.position.y = Math.random() * 800 - 400;
                pr1.position.z = Math.random() * 800 - 400;

             scene.add(pr1)

            });
            textureLoader.load(pic2, function(texture) {
           pr2=crOb(texture,geometry)
           pr2.position.x = Math.random() * 800 - 400;
                pr2.position.y = Math.random() * 800 - 400;
                pr2.position.z = Math.random() * 800 - 400;

             scene.add(pr2)
                
            });  

         textureLoader.load(pic3, function(texture) {
             pr3=crOb(texture,geometry)
             pr3.position.x = Math.random() * 800 - 400;
                pr3.position.y = Math.random() * 800 - 400;
                pr3.position.z = Math.random() * 800 - 400;
                pr3.rotation.z = Math.random() * 2 * Math.PI;
             scene.add(pr3)

    		})
            textureLoader.load(pic3, function(texture) {
           pr2=crOb(texture,geometry)
           pr2.position.x = Math.random() * 800 - 400;
                pr2.position.y = Math.random() * 800 - 400;
                pr2.position.z = Math.random() * 800 - 400;

             scene.add(pr2)
                
            });  

         textureLoader.load(pic3, function(texture) {
             pr3=crOb(texture,geometry)
             pr3.position.x = Math.random() * 800 - 400;
                pr3.position.y = Math.random() * 800 - 400;
                pr3.position.z = Math.random() * 800 - 400;
                pr3.rotation.z = Math.random() * 2 * Math.PI;
             scene.add(pr3)

    		})
            renderer = new THREE.WebGLRenderer({
                antialias: true
            });
            renderer.setClearColor(0xf0f0f0);
            renderer.setPixelRatio(window.devicePixelRatio);
            renderer.setSize(window.innerWidth, window.innerHeight);
            renderer.sortObjects = false;
            container.appendChild(renderer.domElement);

            equi = new CubemapToEquirectangular(renderer, true);

            controls = new THREE.OrbitControls(camera, renderer.domElement);

      //   controls = new TrackballControls( camera, renderer.domElement );

//controls.rotateSpeed = 1.0;
//controls.zoomSpeed = 1.2;
//controls.panSpeed = 0.8;

//controls.keys = [ 'KeyA', 'KeyS', 'KeyD' ];




            window.addEventListener('resize', onWindowResize, false);
            onWindowResize();

            document.getElementById('capturea').addEventListener('click', function(e) {

                equi.update(camera, scene);

            });

        }
function crOb(texture,geom,pos){
    return  new THREE.Mesh(geom, new THREE.MeshPhongMaterial({
					map:texture    //,
                  //  color: Math.random() * 0xffffff
                }));


}

        function onWindowResize() {

            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();

            renderer.setSize(window.innerWidth, window.innerHeight);

        }


        function animate() {

            requestAnimationFrame(animate);

            controls.update();
            render();

        }

        function render() {

            renderer.render(scene, camera);

        }

        function test() {
            var file = document.getElementById('file').files[0];
            var reader  = new FileReader();
            reader.onload = function(e)  {
                var image = document.createElement("img");
                image.src = e.target.result;
             //   document.body.appendChild(image);
              pr2.material.map=   THREE.ImageUtils.loadTexture(image.src);
              render()
              
         
            }
             reader.readAsDataURL(file);
         }


    </script>

</body>

</html>
