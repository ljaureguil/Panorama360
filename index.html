<!DOCTYPE html>
<html lang="en">

<head>
    <title>CubemapToEquirectangular - Managed</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">
    <style>
        body {
            font-family: Monospace;
            background-color: #f0f0f0;
            color: white;
            margin: 0px;
            overflow: hidden;
        }
        #capture {
            position: absolute;
            left: 20px;
            top: 20px;
            padding: 10px;
            border: 1px solid white;
            z-index: 100;
            cursor: pointer;
            background-color: rgba(0, 0, 0, .4);
        }
        .csels{
            background:rgba(100, 100,1000,.35);
            color:white;
        }
        button{
           background:rgba(100, 100,1000,.35);
            color:white;
            
        }
    </style>
</head>

<body>
  

    <div id="capture"><button id="capturea">Capture</button>
  <input type=file name=filename id=file>
    <button type=button onclick='test()'>Display</button>
 
    <select class="csels"  id="stextures" onchange="selT(this.value)">
        <option>Choose Texture</option>
    </select>
   <select id="meshes" class="csels" onchange="chooseMesh(this.value)">
        <option>Create Object</option>
        <option>Box</option>
        <option>Sphere</option>
        <option>Line</option>
        <option>Cylinder</option>
        <option>Label</option>     
        <option>Torus</option> 

    </select>
    <select class="csels"  id="smeshes" onchange="selMesh()">
        <option>Choose Object</option>
    </select>
    </div> 
  
    <script src="js/ImageData-polyfill.js"></script>
    <script src="js/canvas.toBlob-polyfill.js"></script>
    <script src="js/three.min.js"></script> 
  

    <script src="js/OrbitControls.js"></script> 
      <script src="TrackballControls.js"></script>
    <script src="js/CubemapToEquirectangular.js"></script>
   
    <script src="textures.js"></script>

    <script>
 
    </script>
    
    <script>

var pr1, pr2, pr3
        var equi;

        var container, stats;
        var camera, scene, renderer;
        var controls;

        var radius = 100,
            theta = 0;

        window.addEventListener('load', function() {
            init();
            animate();
        });

        var cubeCamera;
       
        function init() {

            container = document.createElement('div');
            document.body.appendChild(container);

            camera = new THREE.PerspectiveCamera(60, window.innerWidth / window.innerHeight, 1, 10000);
            camera.position.set(1, 1, 1);

            scene = new THREE.Scene();

            var light = new THREE.DirectionalLight(0xffffff, 1);
            light.position.set(1, 1, 1).normalize();
            scene.add(light);

			alight = new THREE.AmbientLight( 0xaaaaaa );
			scene.add(alight)
            var textureLoader = new THREE.TextureLoader();
             textureLoader.load(art[3].pic, function(texture) {

                texture.mapping = THREE.UVMapping;

                matworld1 = new THREE.MeshBasicMaterial({
                    side: THREE.DoubleSide,
                    map: texture,
                    transparent: true,
                    opacity: 1 //.450
                });
                world1 = new THREE.Mesh(new THREE.SphereBufferGeometry(900, 312, 116), matworld1);
                world1.scale.x = -1;
                scene.add(world1);
            })
            var geometry = new THREE.BoxBufferGeometry( 190,160, 110);
         var d=600;
  
            textureLoader.load(art[3].pic, function(texture) {
           pr2=crOb(texture,geometry)
           pr2.position.x=0;
           pr2.position.z=-300;
           pr2.name="Pr2"

             scene.add(pr2)
                
            });  
     
          
            renderer = new THREE.WebGLRenderer({
                antialias: true
            });
            renderer.setClearColor(0xf0f0f0);
            renderer.setPixelRatio(window.devicePixelRatio);
            renderer.setSize(window.innerWidth, window.innerHeight);
            renderer.sortObjects = false;
            container.appendChild(renderer.domElement);

            equi = new CubemapToEquirectangular(renderer, true);
   setUpSels();
       //     controls = new THREE.OrbitControls(camera, renderer.domElement);
controls = new THREE.TrackballControls( camera, renderer.domElement );
    //  setTimeout(function(){  controls = new THREE.TrackballControls( camera, renderer.domElement );},5000);

controls.rotateSpeed = 1.0;
controls.zoomSpeed = 1.2;
controls.panSpeed = 0.8;

controls.keys = [ 'KeyA', 'KeyS', 'KeyD' ];
          window.addEventListener('resize', onWindowResize, false);
            onWindowResize();

            document.getElementById('capturea').addEventListener('click', function(e) {

                equi.update(camera, scene);
         
            });
  
        
        }
        function selT(v){
     
            for( var i=0;i<art.length;i++){
                if(art[i].name===v){
                      pr2.material.map=THREE.ImageUtils.loadTexture(art[i].pic);
                    i=art.length;
                }
        
            }   
          
        }
        function setUpSels(){
             var s=stextures.innerHTML+"<option>";
             
            for( var i=0;i<art.length;i++){
                s+="<option>"+art[i].name+"</option>";
        
            } 
   
            stextures.innerHTML=s;
          setupMeshs();
        }

        function setupMeshs(){
    var ms=scene.children;
    var s=smeshes.innerHTML;
    for(var i=0;i<ms.length;i++){
        if(ms[i].name!=undefined){
        s+="<option>"+ms[i].name+"</option>";
}
smeshes.innerHTML=s;
    }
}
function chooseMesh(m){
        var n=prompt("Name");
  if(m==="Box"){
  
      var w=prompt("Width")*1;
      var d=prompt("Depth")*1;
      var h=prompt("Heigth")*1
      scene.add(Box(n,w,d,h))

  }
  if(m==="Sphere"){
   var r=prompt("Radius?")*1;
   var sx=40,sy=20;
   scene.add(Sphere(r,sx,sy))
}

if(m==="Cylinder"){

}
if(m==="Torus"){

}

}

function crOb(texture,geom,pos){

    return  new THREE.Mesh(geom, new THREE.MeshPhongMaterial({
					map:texture,
                    transparent:true    //,
                      }));


}
function crObject(callback){
    if(callback!=undefined){
        var c=new THREE.Mesh(geom, new THREE.MeshPhongMaterial({
					map:texture    //,
                  //  color: Math.random() * 0xffffff
                }));

    callback(c)

    }
}

        function onWindowResize() {

            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();

            renderer.setSize(window.innerWidth, window.innerHeight);

        }


        function animate() {

            requestAnimationFrame(animate);

            controls.update();
            render();

        }

        function render() {

            renderer.render(scene, camera);

        }

        function test() {
            var file = document.getElementById('file').files[0];
           var reader  = new FileReader();
            reader.onload = function(e)  {
                var image = document.createElement("img");
                image.src = e.target.result;
             //   document.body.appendChild(image);
            
             pr2.material.map=THREE.ImageUtils.loadTexture(image.src);
        //     pr2.material.needsUpdate=true;
        //      render()
              
         
            }
             reader.readAsDataURL(file);
         }


    </script>

</body>

</html>

